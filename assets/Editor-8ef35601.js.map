{"version":3,"file":"Editor-8ef35601.js","sources":["../../src/pages/Editor/Editor.tsx"],"sourcesContent":["import { createComputed } from 'solid-js'\nimport { createStore } from 'solid-js/store'\nimport { useStore } from '../../store/storeContext'\n\nimport { ListErrors } from '../../components/ListErrors'\nimport { IArticle } from '../../api/RealWorldApi'\n\nimport { logger } from '../../utils/logger'\n\ninterface IEditState extends IArticle {\n  tagInput: string\n  tagList: string[]\n  inProgress: boolean\n  errors: string\n}\n\ninterface IEditProps {\n  slug: string\n}\n\nexport default ({ slug }: IEditProps) => {\n  const [store, { createArticle, updateArticle }] = useStore()\n  const [state, setState] = createStore<IEditState>({ tagInput: '', tagList: [] })\n\n  logger.info('***** Editor[slug=%s] **********', slug)\n\n  logger.info('Article (slug=%s) inStore=%s', slug, (slug in store.articles))\n\n  const updateState = field => (ev: InputEvent) => {\n    setState(field, ev.target.value)\n  }\n\n  const handleAddTag = () => {\n    if (state.tagInput) {\n      setState((s: IEditState) => {\n        s.tagList.push(s.tagInput.trim())\n        s.tagInput = ''\n      })\n    }\n  }\n\n  const handleRemoveTag = tag => {\n    !state.inProgress && setState('tagList', tags => tags.filter(t => t !== tag))\n  }\n\n  const handleTagInputKeyDown = (ev: InputEvent) => {\n    switch (ev.keyCode) {\n      case 13: // Enter\n      case 9: // Tab\n      case 188: // ,\n        if (ev.keyCode !== 9) ev.preventDefault()\n        handleAddTag()\n        break\n      default:\n        break\n    }\n  }\n\n  const submitForm = async (ev: Event) => {\n    ev.preventDefault()\n    setState({ inProgress: true })\n\n    try {\n      const { inProgress, tagsInput, ...article } = state\n\n      if (slug) {\n        await updateArticle(article)\n      }\n      else {\n        await createArticle(article)\n      }\n\n      location.hash = `/article/${article.slug}`\n    } catch(error) {\n      setState(error)\n    } finally {\n      setState({ inProgress: false })\n    }\n\n  }\n\n  createComputed(() => {\n    logger.info('createComputed (slug=%s)', slug)\n    if (slug) {\n      const article = store.articles[slug]\n      if (article) {\n        logger.info('editing article (slug=%s)', slug)\n        setState(article)\n      }\n      else {\n        logger.info('Article not in store (slug=%s)', slug)\n      }\n    }\n  })\n\n  return (\n    <div class=\"editor-page\">\n      <div class=\"container page\">\n        <div class=\"row\">\n          <div class=\"col-md-10 offset-md-1 col-xs-12\">\n            <ListErrors errors={state.errors} />\n            <form>\n              <fieldset>\n                <fieldset class=\"form-group\">\n                  <input\n                    type=\"text\"\n                    class=\"form-control form-control-lg\"\n                    placeholder=\"Article Title\"\n                    value={state.title || ''}\n                    onChange={updateState('title')}\n                    disabled={state.inProgress}\n                  />\n                </fieldset>\n                <fieldset class=\"form-group\">\n                  <input\n                    type=\"text\"\n                    class=\"form-control\"\n                    placeholder=\"What's this article about?\"\n                    value={state.description || ''}\n                    onChange={updateState('description')}\n                    disabled={state.inProgress}\n                  />\n                </fieldset>\n                <fieldset class=\"form-group\">\n                  <textarea\n                    class=\"form-control\"\n                    rows=\"8\"\n                    placeholder=\"Write your article (in markdown)\"\n                    value={state.body || ''}\n                    onChange={updateState('body')}\n                    disabled={state.inProgress}\n                  ></textarea>\n                </fieldset>\n                <fieldset class=\"form-group\">\n                  <input\n                    type=\"text\"\n                    class=\"form-control\"\n                    placeholder=\"Enter tags\"\n                    value={state.tagInput}\n                    onChange={updateState('tagInput')}\n                    onBlur={handleAddTag}\n                    onKeyup={handleTagInputKeyDown}\n                    disabled={state.inProgress}\n                  />\n                  <div class=\"tag-list\">\n                    <For each={state.tagList}>\n                      {tag => (\n                        <span class=\"tag-default tag-pill\">\n                          <i class=\"ion-close-round\" onClick={[handleRemoveTag, tag]} />\n                          {tag}\n                        </span>\n                      )}\n                    </For>\n                  </div>\n                </fieldset>\n                <button class=\"btn btn-lg pull-xs-right btn-primary\" type=\"button\" disabled={state.inProgress} onClick={submitForm}>\n                  Publish Article\n                </button>\n              </fieldset>\n            </form>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n"],"names":["Editor","slug","store","createArticle","updateArticle","useStore","state","setState","createStore","tagInput","tagList","logger","info","articles","updateState","field","ev","target","value","handleAddTag","s","push","trim","handleRemoveTag","tag","inProgress","tags","filter","t","handleTagInputKeyDown","keyCode","preventDefault","submitForm","tagsInput","article","location","hash","error","createComputed","_el$","_tmpl$","_el$2","firstChild","_el$3","_el$4","_el$5","_el$6","_el$7","_el$8","_el$9","nextSibling","_el$10","_el$11","_el$12","_el$13","_el$14","_el$15","_el$16","_$insert","_$createComponent","ListErrors","errors","_$addEventListener","$$keyup","addEventListener","_$For","each","children","_el$17","_tmpl$2","_el$18","$$click","$$clickData","_$effect","_p$","_v$","_v$2","_v$3","_v$4","_v$5","disabled","undefined","title","description","body","_$delegateEvents"],"mappings":"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"}